#NicoCache_Py(仮)

#これは何？

これは、ニコニコ動画の動画をキャッシュしたりするソフトです。
nicocache_nlの代わりを目指して作られています。

まだ作りかけです。一応動きますが、機能は少ないので、nicocache_nlを使ったほうが良いでしょう。
コードを読んでアドバイスをくれたり、協力してくれる人を求めています。

ライセンスはGPLv3です。

#なぜNicoCache_nl+modの再発明が必要？

そもそもそんな必要はないです。
 - 自分用に汎用的に使えるプロクシサーバが欲しかったのでついでに作った
 - ARM版のjavaランタイムをoracleがプロプライエタリにしてしかも再配布禁止にしてるのがムカついた
 - そのおかげでせっかく苦労しておうちのNASにjava入れたのにまともに動いてくれなかった
 - 本家nlのソースコードがデカすぎて追い切れなかった
そんなんで、じゃあどうせなら自分用にNicoCacheモドキつくるかーと思って作ったのを公開しただけです。こんなものを無理して使う必要など全くないのです！
もちろん使ってくれてバグ報告とかしていただければ嬉しいですが。

#NicoCache_Py(仮)を動かすのに必要なもの

python2.7が必要です。
https://www.python.org/downloads/ にあります。
windowsの人は "C:\Python27" にpythonをインストールしてください。
それが嫌な人は、適宜NicoCache_Py.batを書き換えてください。(詳しい方はpathを追加して云々しても良いでしょう)




#設定

config.pyを編集すると、設定が変えられます。
詳しくはconfig.pyの上の方に書いてあることを読んでください。



#コマンドAPI
    http://www.nicovideo.jp/watch/smXXXX/save
にアクセスすると、cache直下にあるsmXXXXのキャッシュ動画ファイルがcache/saveに移動され、ファイル名にタイトルと拡張子がつきます。

    http://www.nicovideo.jp/watch/smXXXX/unsave
にアクセスすると、cache/saveにあるsmXXXXのキャッシュにsaveコマンドと逆の操作が行われます。

    http://www.nicovideo.jp/watch/smXXXX/rename
にアクセスすると、cache直下にあるsmXXXXのキャッシュ動画ファイルが削除されます。


次のブックマークレットを使うとsaveコマンドを1クリックで実行できます。
ブラウザでhttp://www.nicovideo.jp/watch/smXXXXを開いている時に仕様してください。
javascript: $.get(location.href + "/save", function(data){alert(data)})

コマンドAPIは動画をキャッシュしている最中でも使えます。
windowsは使用中のファイルに対する操作が行えないので、キャッシュsuspend時、もしくはcomplete時に操作が実行されます。

なので、removeコマンドを実行したキャッシュをsaveできてしまったりします(実際はそう見えるだけ)。

#その他

引数に debug という文字を渡すと詳細なログを出力します。


#以下開発者向け
初版から内部アーキテクチャが二転三転しながら、なんとか今のアーキテクチャに落ち着きました。自分が考える上で一番マシな設計になったと思います。

ニコニコに関係ない部分はnicocache/proxthetaディレクトリに分離されています。
これは、プロクシサーバを実装するための、自作の低水準ライブラリ/フレームワークです。
よくあるオブジェクト指向ベースのwebフレームワークとは違い、なるべく関数型プログラミングチックになっています。

proxthetaのAPIは大きく変わる予定はありませんが、python3に移植するときにhttpmesモジュールのAPIを少し修正する予定です。
proxthetaのライセンスはWTFPLv2です。好き勝手流用して構いません(無保証ですが)。


作った人: LHO425 (【ニコニコ】自動ローカル保存プロクシ NicoCache19 スレの142)
